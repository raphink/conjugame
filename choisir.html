<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conjugaison Fran√ßaise - Choisir la Forme</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Arial', sans-serif;
        }
        .game-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            margin-top: 50px;
            margin-bottom: 50px;
        }
        .score-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: #495057;
        }
        .answer-feedback {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        .correct {
            background-color: #d4edda;
            color: #155724;
        }
        .incorrect {
            background-color: #f8d7da;
            color: #721c24;
        }
        .flag-colors {
            background: linear-gradient(to right, #002395 33%, white 33%, white 66%, #ED2939 66%);
            height: 10px;
            margin-bottom: 20px;
        }
        .game-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .game-title {
            color: #495057;
            font-weight: bold;
        }
        .next-btn {
            margin-top: 15px;
        }
        .difficulty-selector {
            margin-bottom: 20px;
        }
        #loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        .spinner-border {
            width: 3rem;
            height: 3rem;
        }
        .progress-container {
            margin-top: 20px;
        }
        .verb-form-info {
            font-size: 1.3rem;
            margin: 20px 0;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 10px;
            text-align: center;
        }
        .verb-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        .verb-option {
            padding: 15px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.2rem;
            text-align: center;
        }
        .verb-option:hover {
            background-color: #e9ecef;
        }
        .verb-option.selected {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
        .game-mode-links {
            margin-top: 30px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="flag-colors"></div>
        <div class="game-header">
            <h1 class="game-title">Conjugaison Fran√ßaise</h1>
            <h4>Mode: Choisir la Forme Correcte</h4>
        </div>

        <div class="row mb-4">
            <div class="col">
                <div class="score-display">
                    Score: <span id="score">0</span> / <span id="total">0</span>
                </div>
            </div>
            <div class="col text-end">
                <div class="streak-display">
                    S√©rie: <span id="streak">0</span> üî•
                </div>
            </div>
        </div>

        <div class="difficulty-selector text-center mb-4">
            <h6>Niveau de difficult√©:</h6>
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-primary difficulty-btn active" data-level="facile">Facile</button>
                <button type="button" class="btn btn-outline-primary difficulty-btn" data-level="moyen">Moyen</button>
                <button type="button" class="btn btn-outline-primary difficulty-btn" data-level="difficile">Difficile</button>
            </div>
        </div>

        <div id="loading" class="text-center">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Chargement...</span>
            </div>
            <p>Chargement des donn√©es du verbe...</p>
        </div>

        <div class="verb-info text-center">
            <h3><span id="verb-infinitive" class="badge bg-primary">chargement...</span></h3>
        </div>

        <div class="verb-form-info">
            Conjuguez au <strong><span id="verb-temps">chargement...</span></strong> du <strong><span id="verb-mode">chargement...</span></strong>, 
            <strong><span id="verb-personne">chargement...</span></strong> personne
        </div>

        <div class="verb-options" id="verb-options">
            <!-- Les options de conjugaison seront ajout√©es dynamiquement -->
        </div>

        <button class="btn btn-success w-100 mt-4" id="check-answer">V√©rifier la r√©ponse</button>

        <div class="answer-feedback mt-4" id="feedback">
            
        </div>

        <button class="btn btn-primary w-100 next-btn" id="next-question">Question suivante</button>

        <div class="progress-container">
            <h6>Progr√®s:</h6>
            <div class="progress" role="progressbar">
                <div id="progress-bar" class="progress-bar" style="width: 0%"></div>
            </div>
        </div>

        <div class="game-mode-links">
            <p>Changer de mode de jeu :</p>
            <a href="index.html" class="btn btn-outline-secondary">Accueil</a>
            <a href="identifier.html" class="btn btn-outline-primary">Mode: Identifier la Forme</a>
        </div>
    </div>

    <!-- Script pour le jeu -->
    <script>
        // Verbes fran√ßais par niveau de difficult√©
        const verbesFaciles = [
            "√™tre", "avoir", "faire", "dire", "aller", "voir", "parler", "aimer", "manger", "finir", "jouer", "venir", "prendre",
            "donner", "appeler", "attendre", "comprendre", "conna√Ætre", "croire", "demander", "entendre", "√©crire", "√©tudier",
            "habiter", "lire", "mettre", "montrer", "ouvrir", "penser", "perdre", "porter", "pouvoir", "regarder", "rendre",
            "r√©pondre", "savoir", "sentir", "sortir", "suivre", "travailler", "trouver", "vendre", "vivre", "vouloir",
            "acheter", "arriver", "chanter", "choisir", "commencer", "compter", "courir", "d√©couvrir", "descendre", "dessiner",
            "dormir", "√©couter", "envoyer", "esp√©rer", "fermer", "imaginer", "inviter", "laisser", "marcher", "monter",
            "offrir", "oublier", "partir", "passer", "pr√©f√©rer", "pr√©parer", "rentrer", "rester", "revenir", "sembler"
        ];

        const verbesMoyens = [
            "pouvoir", "vouloir", "savoir", "devoir", "croire", "mettre", "lire", "√©crire", "comprendre", "attendre",
            "entendre", "partir", "sortir", "sentir", "suivre", "vivre", "boire", "envoyer", "recevoir", "appeler",
            "apercevoir", "appara√Ætre", "apprendre", "atteindre", "combattre", "conduire", "construire", "contenir", "contribuer", "convenir",
            "correspondre", "couvrir", "craindre", "d√©cevoir", "d√©fendre", "d√©finir", "d√©truire", "dispara√Ætre", "distraire", "entretenir",
            "entreprendre", "√©quivaloir", "√©tablir", "√©teindre", "√©tendre", "fournir", "fuir", "inclure", "inscrire", "interrompre",
            "intervenir", "introduire", "maintenir", "mentir", "obtenir", "offrir", "ouvrir", "para√Ætre", "parcourir", "parvenir",
            "percevoir", "peindre", "permettre", "plaindre", "plaire", "poursuivre", "pr√©voir", "produire", "promettre", "reconna√Ætre",
            "recourir", "r√©duire", "rejoindre", "remettre", "remplir", "r√©pandre", "r√©pondre", "r√©soudre", "retenir", "r√©unir",
            "revenir", "rompre", "servir", "souffrir", "sourire", "soutenir", "suffire", "surprendre", "survivre", "taire",
            "tendre", "traduire", "transmettre", "valoir", "vendre", "v√™tir"
        ];

        const verbesDifficiles = [
            "courir", "mourir", "tenir", "venir", "acqu√©rir", "asseoir", "battre", "conna√Ætre", "craindre", "cro√Ætre",
            "cueillir", "falloir", "joindre", "na√Ætre", "plaire", "pleuvoir", "r√©soudre", "rire", "suffire", "vaincre",
            "abstraire", "accro√Ætre", "adjoindre", "advenir", "assaillir", "astreindre", "circonvenir", "clore", "compara√Ætre", "complaire",
            "compromettre", "concevoir", "conclure", "concourir", "conqu√©rir", "convaincre", "d√©coudre", "d√©crire", "d√©duire", "d√©faire",
            "d√©plaire", "d√©teindre", "devenir", "disconvenir", "disjoindre", "dissoudre", "distraire", "√©battre", "√©choir", "√©lire",
            "√©mettre", "√©moudre", "enceindre", "enclore", "encourir", "endormir", "enfuir", "enjoindre", "entendre", "entremettre",
            "entrevoir", "entrouvrir", "envahir", "√©quivaloir", "exclure", "extraire", "faillir", "feindre", "forfaire", "g√©sir",
            "ha√Ør", "inscrire", "instruire", "interdire", "interjeter", "luire", "malfaire", "m√©dire", "m√©faire", "m√©prendre",
            "mouvoir", "nuire", "occlure", "occire", "omettre", "pa√Ætre", "para√Ætre", "parfaire", "parvenir", "percevoir",
            "poindre", "pourfendre", "pourvoir", "pr√©concevoir", "pr√©dire", "prescrire", "pr√©valoir", "pr√©voir", "promouvoir", "proscrire",
            "provenir", "rabattre", "rasseoir", "rassortir", "recevoir", "reconqu√©rir", "recoudre", "recourir", "recueillir", "redevenir",
            "redire", "r√©√©lire", "rejoindre", "relire", "reluire", "remettre", "remoudre", "rena√Ætre", "renvoyer", "repa√Ætre",
            "requ√©rir", "resservir", "ressortir", "restreindre", "retenir", "revaloir", "rev√™tir", "revivre", "saillir", "satisfaire",
            "secourir", "seoir", "soumettre", "sourdre", "soustraire", "subvenir", "surproduire", "surseoir", "survenir", "taire",
            "teindre", "tressaillir", "valoir", "vouloir"
        ];

        // D√©finir les temps disponibles par mode et niveau de difficult√©
        const modesTempsFaciles = {
            "indicatif": ["pr√©sent", "futur-simple", "pass√©-compos√©", "imparfait"]
        };

        const modesTempsIntermediaires = {
            "indicatif": ["pr√©sent", "futur-simple", "pass√©-compos√©", "imparfait", "plus-que-parfait", "pass√©-simple"],
            "subjonctif": ["pr√©sent"],
            "conditionnel": ["pr√©sent"],
            "imperatif": ["imperatif-pr√©sent"]
        };

        const modesTempsAvances = {
            "indicatif": ["pr√©sent", "futur-simple", "pass√©-compos√©", "imparfait", "plus-que-parfait", "pass√©-simple", "futur-ant√©rieur", "pass√©-ant√©rieur"],
            "subjonctif": ["pr√©sent", "pass√©", "imparfait", "plus-que-parfait"],
            "conditionnel": ["pr√©sent", "pass√©"],
            "imperatif": ["imperatif-pr√©sent", "imperatif-pass√©"]
        };

        // Noms fran√ßais des temps pour l'affichage
        const nomsFrancaisTemps = {
            "pr√©sent": "Pr√©sent",
            "futur-simple": "Futur simple",
            "pass√©-compos√©": "Pass√© compos√©",
            "imparfait": "Imparfait",
            "plus-que-parfait": "Plus-que-parfait",
            "pass√©-simple": "Pass√© simple",
            "futur-ant√©rieur": "Futur ant√©rieur",
            "pass√©-ant√©rieur": "Pass√© ant√©rieur",
            "pass√©": "Pass√©",
            "imperatif-pr√©sent": "Pr√©sent",
            "imperatif-pass√©": "Pass√©"
        };

        // Noms des personnes pour l'affichage
        const personnesAbr√©g√©es = [
            "1√®re (je)", "2√®me (tu)", "3√®me (il/elle)", "1√®re (nous)", "2√®me (vous)", "3√®me (ils/elles)"
        ];

        const personnesImperatif = ["2√®me (tu)", "1√®re (nous)", "2√®me (vous)"];

        // √âtat du jeu
        let score = 0;
        let totalQuestions = 0;
        let streak = 0;
        let verbeActuel = "";
        let conjugaisonActuelle = "";
        let donneesDuVerbe = null;
        let reponseActuelle = {
            personne: null,
            mode: "",
            temps: ""
        };
        let niveauDifficulte = "facile";
        let objectifScore = 10; // Nombre de questions √† r√©pondre correctement pour "gagner"
        let optionsConjugaison = []; // Options de conjugaison √† afficher
        let indexOptionCorrecte = -1; // Index de l'option correcte

        // Configuration du proxy CORS et de l'API
        const PROXY_URL = "https://api.allorigins.win/raw?url=";
        const API_BASE_URL = "http://verbe.cc/verbecc/conjugate/fr/";

        // Fonction pour appeler l'API Verbecc en utilisant le proxy CORS
        async function appelerAPI(verbe) {
            $('#loading').show();

            try {
                // Utiliser le proxy CORS pour acc√©der √† l'API HTTP
                const apiUrl = `${PROXY_URL}${encodeURIComponent(API_BASE_URL + encodeURIComponent(verbe))}`;
                
                const response = await fetch(apiUrl);
                
                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
                
                const data = await response.json();

                $('#loading').hide();

                if (!data || !data.value) {
                    throw new Error("Format de donn√©es inattendu");
                }

                return data.value;
            } catch (error) {
                console.error('Erreur:', error);
                $('#loading').hide();
                alert(`Erreur lors de la r√©cup√©ration des donn√©es: ${error.message}`);
                return null;
            }
        }

        // Initialiser le jeu
        $(document).ready(function() {
            // Gestion des niveaux de difficult√©
            $('.difficulty-btn').click(function() {
                $('.difficulty-btn').removeClass('active');
                $(this).addClass('active');
                niveauDifficulte = $(this).data('level');
                
                // G√©n√©rer une nouvelle question pour le niveau s√©lectionn√©
                questionSuivante();
            });
            
            // Gestion des options de conjugaison
            $(document).on('click', '.verb-option', function() {
                $('.verb-option').removeClass('selected');
                $(this).addClass('selected');
            });

            $('#check-answer').click(verifierReponse);
            $('#next-question').click(questionSuivante);

            // Commencer le jeu
            questionSuivante();
        });

        function obtenirListeVerbes() {
            switch(niveauDifficulte) {
                case "facile":
                    return verbesFaciles;
                case "moyen":
                    return [...verbesFaciles, ...verbesMoyens];
                case "difficile":
                    return [...verbesFaciles, ...verbesMoyens, ...verbesDifficiles];
                default:
                    return verbesFaciles;
            }
        }

        // Fonction pour g√©n√©rer des options de r√©ponse incorrectes mais plausibles
        function genererOptionsIncorrectes(formeCorrecte, donneesDuVerbe, modeCorrect, tempsCorrect) {
            const options = [];
            const nombreOptions = 3; // Nombre d'options incorrectes √† g√©n√©rer
            const personneIdx = reponseActuelle.personne; // Personne pour laquelle g√©n√©rer des options
            
            // Strat√©gie 1: Utiliser le m√™me indice de personne mais d'autres temps du m√™me mode
            const autresTompsMode = Object.keys(donneesDuVerbe.moods[modeCorrect])
                .filter(t => t !== tempsCorrect);
                
            if (autresTompsMode.length > 0) {
                for (const autreTemps of autresTompsMode) {
                    if (donneesDuVerbe.moods[modeCorrect][autreTemps] && 
                        donneesDuVerbe.moods[modeCorrect][autreTemps].length > personneIdx) {
                        const option = donneesDuVerbe.moods[modeCorrect][autreTemps][personneIdx];
                        if (option !== formeCorrecte && !options.includes(option) && options.length < nombreOptions) {
                            options.push(option);
                        }
                    }
                }
            }
            
            // Strat√©gie 2: Utiliser d'autres modes mais la m√™me personne
            const autresModes = Object.keys(donneesDuVerbe.moods)
                .filter(m => m !== modeCorrect && m !== "participe" && m !== "infinitif");
                
            if (autresModes.length > 0 && options.length < nombreOptions) {
                for (const autreMode of autresModes) {
                    const temps = Object.keys(donneesDuVerbe.moods[autreMode]);
                    if (temps.length > 0) {
                        for (const unTemps of temps) {
                            if (donneesDuVerbe.moods[autreMode][unTemps] && 
                                donneesDuVerbe.moods[autreMode][unTemps].length > personneIdx) {
                                const option = donneesDuVerbe.moods[autreMode][unTemps][personneIdx];
                                if (option !== formeCorrecte && !options.includes(option) && options.length < nombreOptions) {
                                    options.push(option);
                                }
                            }
                        }
                    }
                }
            }
            
            // Si nous n'avons pas assez d'options, cr√©er des variations plausibles
            if (options.length < nombreOptions) {
                // Pour les verbes du premier groupe, cr√©er des erreurs de conjugaison typiques
                if (verbeActuel.endsWith("er") && !verbeActuel.endsWith("ier")) {
                    // Erreur courante: mauvaise terminaison
                    let variation1 = formeCorrecte;
                    if (formeCorrecte.endsWith("e")) {
                        variation1 = formeCorrecte.substring(0, formeCorrecte.length - 1) + "es";
                    } else if (formeCorrecte.endsWith("es")) {
                        variation1 = formeCorrecte.substring(0, formeCorrecte.length - 2) + "e";
                    } else if (formeCorrecte.endsWith("ons")) {
                        variation1 = formeCorrecte.substring(0, formeCorrecte.length - 3) + "ez";
                    } else if (formeCorrecte.endsWith("ez")) {
                        variation1 = formeCorrecte.substring(0, formeCorrecte.length - 2) + "ons";
                    }
                    
                    if (variation1 !== formeCorrecte && !options.includes(variation1) && options.length < nombreOptions) {
                        options.push(variation1);
                    }
                }
                
                // Cr√©er des variations g√©n√©riques pour tout type de verbe
                while (options.length < nombreOptions) {
                    // Changer la derni√®re voyelle ou ajouter/enlever une lettre √† la fin
                    let variation;
                    const random = Math.random();
                    
                    if (random < 0.33 && formeCorrecte.length > 3) {
                        // Changer une lettre au milieu
                        const idx = Math.floor(Math.random() * (formeCorrecte.length - 2)) + 1;
                        const lettresSubstitution = "aeiouy";
                        const lettre = lettresSubstitution.charAt(Math.floor(Math.random() * lettresSubstitution.length));
                        variation = formeCorrecte.substring(0, idx) + lettre + formeCorrecte.substring(idx + 1);
                    } else if (random < 0.66) {
                        // Modifier la terminaison
                        if (formeCorrecte.endsWith("s")) {
                            variation = formeCorrecte.substring(0, formeCorrecte.length - 1) + "t";
                        } else if (formeCorrecte.endsWith("t")) {
                            variation = formeCorrecte.substring(0, formeCorrecte.length - 1) + "s";
                        } else if (formeCorrecte.endsWith("e")) {
                            variation = formeCorrecte.substring(0, formeCorrecte.length - 1) + "√©s";
                        } else {
                            variation = formeCorrecte + "s";
                        }
                    } else {
                        // Double consonne ou erreur d'accent
                        if (formeCorrecte.includes("√©")) {
                            variation = formeCorrecte.replace("√©", "√®");
                        } else if (formeCorrecte.includes("√®")) {
                            variation = formeCorrecte.replace("√®", "√©");
                        } else {
                            // Trouver une consonne et la doubler
                            const consonnes = "bcdfghjklmnpqrstvwxz";
                            for (let i = 0; i < formeCorrecte.length; i++) {
                                if (consonnes.includes(formeCorrecte[i])) {
                                    variation = formeCorrecte.substring(0, i + 1) + formeCorrecte[i] + formeCorrecte.substring(i + 1);
                                    break;
                                }
                            }
                            
                            // Si aucune consonne trouv√©e, ajouter simplement un 's'
                            if (!variation) {
                                variation = formeCorrecte + "s";
                            }
                        }
                    }
                    
                    if (variation !== formeCorrecte && !options.includes(variation) && variation.length > 1) {
                        options.push(variation);
                    } else {
                        // Si la variation est invalide, juste ajouter une option simple
                        let fallback = formeCorrecte + "s";
                        if (formeCorrecte.endsWith("s")) {
                            fallback = formeCorrecte.substring(0, formeCorrecte.length - 1);
                        }
                        
                        if (fallback !== formeCorrecte && !options.includes(fallback)) {
                            options.push(fallback);
                        } else {
                            // Derni√®re tentative: inverser deux lettres
                            if (formeCorrecte.length > 3) {
                                const idx = Math.floor(Math.random() * (formeCorrecte.length - 3)) + 1;
                                fallback = formeCorrecte.substring(0, idx) + 
                                         formeCorrecte.charAt(idx + 1) + 
                                         formeCorrecte.charAt(idx) + 
                                         formeCorrecte.substring(idx + 2);
                                
                                if (fallback !== formeCorrecte && !options.includes(fallback)) {
                                    options.push(fallback);
                                }
                            }
                        }
                    }
                }
            }
            
            // Limiter les options √† 3 et retourner
            return options.slice(0, nombreOptions);
        }

        // Fonction pour g√©n√©rer une nouvelle question
        async function questionSuivante() {
            // Cacher le feedback
            $('#feedback').hide();
            
            // R√©initialiser les options s√©lectionn√©es
            $('.verb-option').removeClass('selected');
            
            // Choisir un verbe al√©atoire selon le niveau de difficult√©
            const verbesDisponibles = obtenirListeVerbes();
            verbeActuel = verbesDisponibles[Math.floor(Math.random() * verbesDisponibles.length)];
            
            // R√©cup√©rer les donn√©es du verbe via l'API
            donneesDuVerbe = await appelerAPI(verbeActuel);
            
            if (!donneesDuVerbe) {
                // En cas d'erreur avec l'API
                return;
            }
            
            // Afficher l'infinitif du verbe
            $('#verb-infinitive').text(donneesDuVerbe.verb.infinitive);
            
            // Obtenir les modes disponibles pour le niveau actuel
            let formesDisponibles;
            switch (niveauDifficulte) {
                case "facile":
                    formesDisponibles = modesTempsFaciles;
                    break;
                case "moyen":
                    formesDisponibles = modesTempsIntermediaires;
                    break;
                case "difficile":
                    formesDisponibles = modesTempsAvances;
                    break;
                default:
                    formesDisponibles = modesTempsFaciles;
            }
            
            // Choisir un mode al√©atoire parmi ceux disponibles pour ce niveau
            const modes = Object.keys(formesDisponibles).filter(m => Object.keys(donneesDuVerbe.moods).includes(m));
            if (modes.length === 0) {
                console.warn(`Aucun mode disponible pour ce verbe et ce niveau de difficult√©`);
                questionSuivante(); // Essayer un autre verbe
                return;
            }
            const mode = modes[Math.floor(Math.random() * modes.length)];
            
            // Choisir un temps al√©atoire pour ce mode
            const tempsDisponibles = formesDisponibles[mode].filter(t => Object.keys(donneesDuVerbe.moods[mode]).includes(t));
            if (tempsDisponibles.length === 0) {
                console.warn(`Aucun temps disponible pour le verbe ${verbeActuel} au mode ${mode}`);
                questionSuivante(); // Essayer un autre verbe/mode
                return;
            }
            const temps = tempsDisponibles[Math.floor(Math.random() * tempsDisponibles.length)];
            
            // V√©rifier si le temps existe pour ce verbe
            if (!donneesDuVerbe.moods[mode][temps] || donneesDuVerbe.moods[mode][temps].length === 0) {
                console.warn(`Le temps ${temps} n'existe pas pour le verbe ${verbeActuel} au mode ${mode}`);
                questionSuivante(); // Essayer un autre verbe/mode/temps
                return;
            }
            
            // Choisir une personne al√©atoire (tenant compte du fait que l'imp√©ratif n'a que 3 personnes)
            let maxPersonne = donneesDuVerbe.moods[mode][temps].length - 1;
            const indicePersonne = Math.floor(Math.random() * (maxPersonne + 1));
            
            // Stocker la r√©ponse correcte
            reponseActuelle = {
                personne: indicePersonne,
                mode: mode,
                temps: temps
            };
            
            // Afficher l'information sur la forme demand√©e
            $('#verb-mode').text(mode);
            $('#verb-temps').text(nomsFrancaisTemps[temps] || temps);
            
            if (mode !== "imperatif") {
                $('#verb-personne').text(personnesAbr√©g√©es[indicePersonne]);
            } else {
                $('#verb-personne').text(personnesImperatif[indicePersonne]);
            }
            
            // R√©cup√©rer la conjugaison correcte
            conjugaisonActuelle = donneesDuVerbe.moods[mode][temps][indicePersonne];
            
            // G√©n√©rer des options incorrectes
            optionsConjugaison = genererOptionsIncorrectes(conjugaisonActuelle, donneesDuVerbe, mode, temps);
            
            // M√©langer les options
            indexOptionCorrecte = Math.floor(Math.random() * (optionsConjugaison.length + 1));
            optionsConjugaison.splice(indexOptionCorrecte, 0, conjugaisonActuelle);
            
            // Afficher les options
            const optionsContainer = $('#verb-options');
            optionsContainer.empty();
            
            optionsConjugaison.forEach((option, index) => {
                optionsContainer.append(`
                    <div class="verb-option" data-index="${index}">
                        ${option}
                    </div>
                `);
            });
        }

        // Fonction pour v√©rifier la r√©ponse
        function verifierReponse() {
            if (!donneesDuVerbe) {
                alert("Veuillez d'abord charger un verbe");
                return;
            }

            totalQuestions++;
            $('#total').text(totalQuestions);
            
            const optionSelectionneeIndex = $('.verb-option.selected').data('index');
            
            // V√©rifier qu'une option a √©t√© s√©lectionn√©e
            if (optionSelectionneeIndex === undefined) {
                alert("Veuillez s√©lectionner une conjugaison");
                totalQuestions--; // Annuler l'incr√©mentation
                $('#total').text(totalQuestions);
                return;
            }
            
            let estCorrect = optionSelectionneeIndex === indexOptionCorrecte;
            
            if (estCorrect) {
                score++;
                streak++;
                $('#score').text(score);
                $('#streak').text(streak);
                
                $('#feedback').removeClass('incorrect').addClass('correct')
                    .html(`<strong>Correct !</strong> "${conjugaisonActuelle}" est bien la forme correcte de "${verbeActuel}".`)
                    .show();
            } else {
                streak = 0;
                $('#streak').text(streak);
                
                $('#feedback').removeClass('correct').addClass('incorrect')
                    .html(`<strong>Incorrect.</strong> La forme correcte est "${conjugaisonActuelle}".`)
                    .show();
            }
            
            // Mettre √† jour la barre de progression
            const pourcentage = Math.min(100, (score / objectifScore) * 100);
            $('#progress-bar').css('width', `${pourcentage}%`);
            
            // V√©rifier si l'objectif est atteint
            if (score >= objectifScore) {
                // F√©liciter l'utilisateur
                const message = `<div class="alert alert-success mt-3">
                    <h4>F√©licitations !</h4>
                    <p>Vous avez atteint votre objectif de ${objectifScore} bonnes r√©ponses !</p>
                    <p>Score final : ${score}/${totalQuestions}</p>
                    <button class="btn btn-success mt-2" onclick="location.reload()">Recommencer</button>
                </div>`;
                
                $('.game-container').append(message);
                $('#next-question').prop('disabled', true);
                $('#check-answer').prop('disabled', true);
            }
        }
    </script>
</body>
</html>